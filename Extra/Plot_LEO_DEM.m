% Parameters (example values)
close all
nx = 24; ny = 60; % Number of nodes in x and y directions
dx = 11.5/nx; dy = 30/ny; % Resolution in meters
nz = 1; % Number of vertical nodes

% Generate example terrain surface and bedrock elevation matrices
x = linspace(0, (nx - 1) * dx, nx); x = flip(x);
y = linspace(0, (ny - 1) * dy, ny);
[x_grid, y_grid] = meshgrid(x, y);

[Spectrum,depth_ramp,terrain_ramp,blue_ramp,blues_2,pallete,Depth_RAS,Terrain_RAS,Velocity_RAS] = coloramps();


% DEM
z_surface = [9.959890366	9.950086594	9.940842628	9.938762665	9.939713478	9.939538956	9.939777374	9.939461708	9.939633369	9.93934536	9.939531326	9.939310074	9.939526558	9.939330101	9.939600945	9.939430237	9.939709663	9.939562798	9.939734459	9.939396858	9.938961029	9.940321922	9.951479912	9.959003448
9.886141777	9.854210854	9.833338737	9.832221031	9.833305359	9.833601952	9.833404541	9.8335495	9.833288193	9.833426476	9.833230972	9.833387375	9.833233833	9.833395958	9.8332901	9.833471298	9.833397865	9.833580017	9.83334446	9.833320618	9.832339287	9.833189964	9.856906891	9.891925812
9.789600372	9.751794815	9.726305008	9.723222733	9.724627495	9.725279808	9.725364685	9.725512505	9.725404739	9.72550106	9.725405693	9.725497246	9.725405693	9.725495338	9.725393295	9.725478172	9.725391388	9.725393295	9.724966049	9.724721909	9.724777222	9.72963047	9.758879662	9.798535347
9.684222221	9.645529747	9.618868828	9.616868019	9.618397713	9.618764877	9.619091988	9.619142532	9.619135857	9.619156837	9.619141579	9.619161606	9.619141579	9.619158745	9.619124413	9.619132996	9.619089127	9.619035721	9.618494034	9.618211746	9.620433807	9.628456116	9.657391548	9.696575165
9.584385872	9.546170235	9.518678665	9.512619972	9.51211071	9.512358665	9.512913704	9.51307106	9.513106346	9.513126373	9.51313591	9.513145447	9.513134003	9.513133049	9.513083458	9.513073921	9.513010979	9.512850761	9.512093544	9.512284279	9.517888069	9.531881332	9.56232357	9.599269867
9.491833687	9.452651978	9.42239666	9.410347939	9.406020164	9.406106949	9.407047272	9.407144547	9.407230377	9.407238007	9.407255173	9.407258034	9.407253265	9.407245636	9.40722084	9.407196999	9.407131195	9.407130241	9.406252861	9.406054497	9.415830612	9.438715935	9.472503662	9.507987976
9.401754379	9.362750053	9.329051971	9.309567451	9.300459862	9.299574852	9.300746918	9.301095963	9.301316261	9.301337242	9.301390648	9.30137825	9.301376343	9.301405907	9.301390648	9.301399231	9.301194191	9.301025391	9.300412178	9.302044868	9.316565514	9.34604454	9.383358002	9.418451309
9.31437397	9.274906158	9.237352371	9.208922386	9.19411087	9.193478584	9.194888115	9.195121765	9.195426941	9.195449829	9.19548893	9.195487022	9.195514679	9.195584297	9.195656776	9.195764542	9.195478439	9.195291519	9.195741653	9.19879055	9.217699051	9.254663467	9.295467377	9.331157684
9.226347923	9.186864853	9.146270752	9.112178802	9.092400551	9.088406563	9.08864975	9.088951111	9.089465141	9.089576721	9.089636803	9.089672089	9.089753151	9.089881897	9.089982033	9.090031624	9.089479446	9.089557648	9.092781067	9.10184288	9.125917435	9.165138245	9.207186699	9.242817879
9.138802528	9.099115372	9.056606293	9.017453194	8.992458344	8.984820366	8.982707024	8.982877731	8.983681679	8.983775139	8.983867645	8.983956337	8.984090805	8.984302521	8.984436989	8.984539986	8.983641624	8.983360291	8.990568161	9.008419991	9.037873268	9.077306747	9.11923027	9.155359268
9.050544739	9.01104641	8.967884064	8.927113533	8.897753716	8.883236885	8.877123833	8.876605034	8.877744675	8.878115654	8.878349304	8.878522873	8.878697395	8.878911972	8.878922462	8.878756523	8.877410889	8.877864838	8.889592171	8.915121078	8.949629784	8.989794731	9.031264305	9.06666851
8.9627285	8.923005104	8.88008213	8.839428902	8.805891037	8.782278061	8.770689964	8.770312309	8.772070885	8.77249527	8.772893906	8.773195267	8.773351669	8.773598671	8.773395538	8.7733078	8.771811485	8.771738052	8.787942886	8.822862625	8.861937523	8.902044296	8.943120003	8.979156494
8.874392509	8.835028648	8.792498589	8.751433372	8.714012146	8.682997704	8.665680885	8.663820267	8.665689468	8.666689873	8.66757679	8.668001175	8.668213844	8.668276787	8.667677879	8.667042732	8.666454315	8.67109108	8.694129944	8.732665062	8.773679733	8.814261436	8.855066299	8.890538216
8.786541939	8.746890068	8.704668999	8.663908005	8.623771667	8.585077286	8.559579849	8.55633831	8.556407928	8.55684185	8.558573723	8.558655739	8.559161186	8.558955193	8.558233261	8.557136536	8.559695244	8.571361542	8.605625153	8.644972801	8.685896873	8.72622776	8.766887665	8.803060532
8.698187828	8.658825874	8.616911888	8.576120377	8.535250664	8.494700432	8.461438179	8.442381859	8.433226585	8.432295799	8.434462547	8.435016632	8.435230255	8.434681892	8.433141708	8.433326721	8.445658684	8.474707603	8.516813278	8.557864189	8.59824276	8.638347626	8.678799629	8.714605331
8.610230446	8.570575714	8.528820992	8.488271713	8.448010445	8.407964706	8.36449337	8.320690155	8.296892166	8.296370506	8.299600601	8.300260544	8.300127029	8.299798965	8.298357964	8.298077583	8.322814941	8.37814045	8.430040359	8.47063446	8.510141373	8.550174713	8.590579987	8.626982689
8.521911621	8.48250103	8.440986633	8.400742531	8.361142159	8.319068909	8.263848305	8.200244904	8.162437439	8.158437729	8.162211418	8.163509369	8.163223267	8.163064957	8.16564846	8.175871849	8.214604378	8.2816782	8.340713501	8.38333416	8.422430038	8.462207794	8.5024786	8.538466454
8.433974266	8.394289017	8.352826118	8.312615395	8.273798943	8.233166695	8.168636322	8.079932213	8.02645874	8.023926735	8.027402878	8.028241158	8.027778625	8.027041435	8.036971092	8.062560081	8.114953995	8.191039085	8.254154205	8.295737267	8.334164619	8.373990059	8.414277077	8.450884819
8.345664978	8.306188583	8.264914513	8.224948883	8.18666935	8.144390106	8.074304581	7.978379726	7.913078785	7.895701885	7.891938686	7.891592503	7.890924454	7.892053127	7.912148476	7.956253052	8.022467613	8.101864815	8.165812492	8.208277702	8.246432304	8.28602314	8.326170921	8.362287521
8.25767231	8.217949867	8.176665306	8.136639595	8.098695755	8.057936668	7.987500191	7.888030529	7.810852051	7.772426605	7.756331921	7.755826473	7.756123543	7.755880356	7.78681469	7.855417252	7.935437679	8.015475273	8.078775406	8.120266914	8.158119202	8.197792053	8.237957954	8.274630547
8.169376373	8.129837036	8.088713646	8.048871994	8.011253357	7.969811916	7.899377346	7.799797535	7.711355686	7.652028084	7.622001171	7.618340969	7.621209621	7.628931046	7.672848701	7.756306171	7.846448421	7.928141594	7.990565777	8.032505035	8.070306778	8.10979557	8.149846077	8.186000824
8.081419945	8.041656494	8.000487328	7.960533619	7.922965527	7.882648468	7.813472748	7.713187218	7.614387035	7.531515121	7.485730648	7.482800961	7.490689278	7.50668335	7.563270092	7.662144661	7.75990057	7.841520786	7.903069496	7.944242954	7.981958389	8.021549225	8.061656952	8.097907066
7.993157864	7.953560829	7.912509918	7.872659206	7.835259438	7.794121265	7.725235462	7.625331879	7.519516468	7.42404604	7.363897324	7.350532055	7.362519741	7.39555645	7.467151642	7.571249962	7.672255993	7.754478931	7.814565659	7.856136322	7.894016743	7.933524609	7.973574162	8.008503914
7.905192852	7.865390778	7.824285984	7.784317017	7.747219086	7.707371712	7.639517307	7.53903389	7.428866386	7.324954987	7.247333527	7.217455864	7.232986927	7.289843559	7.379614353	7.484351635	7.587814808	7.670974255	7.727077007	7.768022537	7.805688381	7.84531498	7.885424614	7.920854092
7.816952705	7.777337074	7.736372471	7.696727753	7.660470963	7.622544765	7.556332588	7.452729702	7.339225292	7.228179932	7.130951405	7.086408615	7.100861073	7.182990551	7.288885593	7.398600578	7.506524563	7.594221115	7.642839432	7.681028366	7.718031406	7.757367134	7.797385216	7.832360744
7.728990555	7.689169884	7.648154259	7.608337402	7.571735859	7.53325367	7.466252327	7.364364147	7.251679897	7.14215374	7.048669815	6.99732542	7.012695312	7.095119476	7.202486515	7.311014175	7.414949417	7.498907089	7.553626537	7.592646599	7.629663467	7.669161797	7.709230423	7.744742393
7.640743256	7.601117611	7.560164928	7.520335197	7.483150005	7.442202091	7.374330521	7.275138378	7.164530754	7.057997227	6.970562935	6.921555042	6.936185837	7.012758732	7.115818977	7.222115993	7.321530819	7.403205395	7.462282658	7.50399828	7.541684151	7.581158638	7.621168613	7.656191826
7.55278635	7.512955189	7.471966743	7.432044506	7.394636154	7.354593277	7.287045479	7.186900616	7.076629639	6.969785213	6.883569717	6.834158421	6.847505093	6.925898552	7.027976036	7.134438038	7.232888222	7.314340115	7.374786377	7.415791512	7.453399658	7.49297905	7.533019543	7.568567276
7.46454525	7.424916267	7.384023666	7.344236851	7.306901455	7.265956879	7.198060513	7.098639011	6.988379478	6.881675243	6.795848846	6.747249603	6.760939121	6.837860107	6.939658642	7.046153069	7.144332886	7.225820541	7.286408901	7.328022957	7.365627289	7.405046463	7.445000172	7.480038643
7.376587391	7.336752892	7.295812607	7.25591135	7.218514442	7.178505898	7.110924721	7.010696888	6.900323868	6.793374062	6.707429409	6.658060074	6.671298027	6.749762058	6.851802349	6.958331108	7.05661869	7.138099194	7.198828697	7.239826202	7.277302742	7.316887856	7.356884003	7.392418385
7.288347244	7.248706818	7.207844257	7.16806221	7.130740166	7.089814663	7.021914482	6.922488213	6.812158585	6.705420494	6.619598389	6.570985317	6.584669113	6.661613941	6.763484001	6.870006561	6.968178749	7.049665928	7.110310078	7.151922703	7.189490318	7.228927612	7.268849373	7.303913116
7.200387478	7.160549164	7.119629383	7.079730988	7.04234314	7.002317905	6.934754848	6.834527969	6.724131584	6.617175102	6.531205654	6.481834888	6.495083809	6.573545456	6.675625801	6.782162666	6.880438328	6.961926937	7.022676468	7.063718319	7.101191998	7.140740395	7.180701733	7.216253757
7.112164497	7.072505951	7.031658173	6.991873741	6.954552174	6.913629055	6.845712662	6.746284962	6.635955334	6.529199123	6.443387985	6.394766808	6.40844965	6.485423088	6.58728981	6.69381237	6.791976452	6.873476982	6.93414259	6.975787163	7.013359547	7.052763462	7.092655659	7.127764702
7.024188995	6.984350681	6.943446159	6.903547764	6.866154194	6.826126099	6.758538246	6.658307552	6.547924042	6.440914154	6.354945183	6.305575371	6.318835258	6.397340298	6.499413013	6.60597086	6.704238415	6.785725594	6.846498013	6.887549877	6.925024986	6.964566708	7.00451088	7.040111542
6.935967922	6.896304131	6.855476856	6.815690517	6.778354645	6.737413406	6.669490814	6.570055008	6.459721565	6.352940559	6.26711607	6.218496323	6.232192993	6.309202194	6.411098003	6.517618179	6.615787983	6.697286606	6.757956505	6.799602032	6.837172985	6.876577377	6.916458607	6.951621532
6.847990513	6.808146477	6.767262459	6.727365494	6.689942837	6.649873734	6.582264423	6.482034683	6.371656418	6.264687538	6.178723812	6.129358292	6.1426301	6.221130371	6.323229313	6.429765701	6.528045177	6.609524727	6.670308113	6.711356163	6.748842716	6.788384914	6.828316212	6.863965511
6.759768009	6.720095158	6.679292202	6.63950491	6.602153778	6.561181545	6.493238926	6.393801212	6.283481598	6.176734447	6.090929985	6.0423069	6.055992603	6.132995129	6.234881401	6.341398716	6.439569473	6.521069527	6.581758976	6.623430252	6.661020279	6.700428486	6.740282536	6.775494576
6.671785831	6.631937027	6.591079235	6.55118227	6.513751984	6.473670483	6.406053066	6.305824757	6.195455551	6.088496685	6.002542496	5.953183174	5.966436386	6.044889927	6.146964073	6.253499985	6.351775646	6.433260918	6.494073868	6.535207748	6.572740555	6.612281322	6.652174473	6.68783617
6.583564281	6.543880463	6.503106594	6.463319778	6.425967216	6.385001183	6.317059517	6.217616558	6.107299328	6.000551224	5.914747715	5.866117954	5.879786491	5.956760406	6.058628082	6.165143967	6.263314247	6.344816208	6.405536652	6.447274685	6.484905243	6.524316311	6.564129829	6.599382877
6.495579243	6.455723286	6.414895535	6.375	6.337569714	6.297483921	6.229866505	6.129641056	6.019271851	5.912314415	5.826361179	5.777004242	5.790251255	5.868690014	5.970755577	6.077289581	6.175564766	6.257050991	6.3178792	6.359030724	6.396580219	6.436125278	6.475986958	6.511718273
6.407357216	6.367660046	6.32692337	6.287133694	6.249782562	6.208821297	6.140882015	6.041434288	5.931117058	5.824368477	5.738563061	5.68993187	5.703597546	5.780578136	5.882444859	5.988961697	6.0871315	6.168632984	6.229353428	6.271087646	6.308731079	6.348150253	6.38792181	6.423276901
6.319368362	6.279502392	6.23871088	6.198816299	6.161385059	6.121294975	6.053678036	5.953456879	5.84308815	5.736131668	5.650176525	5.600821495	5.614074707	5.69250536	5.794573784	5.901109219	5.999381542	6.08086586	6.141691685	6.182846069	6.220405102	6.259955406	6.29978323	6.335612297
6.231148243	6.191434383	6.150738716	6.110949039	6.073589325	6.032617569	5.964678288	5.865239143	5.75492239	5.648161411	5.562344551	5.513708115	5.527380466	5.604383945	5.706264496	5.812782764	5.910952091	5.992452621	6.053172588	6.094903946	6.13255024	6.171977043	6.211734772	6.247205257
6.143153191	6.10327816	6.062526703	6.022632599	5.985183716	5.945050716	5.877426147	5.777247429	5.666885376	5.55989027	5.47391367	5.424563408	5.437832832	5.516299248	5.618387222	5.724923134	5.823194027	5.904677868	5.9655056	6.006660938	6.044235706	6.083821297	6.123631477	6.159544468
6.054933548	6.015200138	5.974544048	5.93473959	5.897362232	5.85637331	5.788433075	5.689010143	5.578698158	5.471914291	5.386086464	5.337446213	5.351124287	5.428155422	5.530046463	5.636564255	5.734732628	5.816234112	5.876964569	5.918708324	5.956383705	5.995845795	6.035571098	6.071176052
5.966932297	5.927043438	5.886326313	5.846392155	5.808930874	5.768825054	5.7012043	5.600997448	5.490629196	5.383667469	5.297708035	5.248360634	5.261620522	5.34005022	5.442121506	5.548657894	5.646927357	5.728412628	5.789253712	5.830453873	5.868059635	5.907655239	5.947437286	5.983513832
5.8787117	5.838954926	5.798344135	5.758505821	5.721122265	5.680169582	5.612235546	5.512777805	5.402459621	5.295709133	5.209900379	5.161257744	5.174916267	5.251922131	5.353793144	5.460309982	5.558477879	5.639980316	5.700722218	5.742486954	5.780173779	5.819653511	5.85935545	5.895191193
5.790702343	5.750795841	5.71013546	5.670193672	5.632731915	5.592628002	5.525007725	5.424798012	5.314429283	5.20747757	5.121525288	5.072183609	5.085436821	5.163851261	5.26591301	5.372447014	5.470718384	5.552202702	5.613037109	5.654211044	5.69181633	5.731451988	5.771224499	5.807547092
5.702480316	5.662697792	5.622158051	5.582319736	5.544936657	5.503988743	5.436057091	5.336596012	5.226277351	5.119524002	5.033717632	4.985071182	4.998727322	5.075739384	5.177610874	5.284127712	5.382297516	5.463795662	5.524520397	5.56624794	5.603939056	5.643454075	5.683138371	5.71932745
5.614461899	5.574534416	5.533950329	5.494009018	5.456550121	5.416442871	5.348822117	5.248614311	5.138247013	5.031295776	4.945342541	4.896003246	4.909258842	4.987665653	5.089729786	5.196264744	5.294534683	5.37601757	5.436841011	5.478007317	5.515618324	5.555263042	5.595011711	5.631639481
5.526237011	5.486421108	5.445941925	5.406115055	5.368753433	5.327808857	5.259879112	5.160415649	5.050096512	4.943341732	4.85751915	4.808859348	4.822511673	4.899543285	5.001426697	5.107945442	5.206119537	5.287620068	5.34833622	5.39006424	5.427743435	5.467265606	5.506940842	5.5432024
5.438204765	5.398252487	5.357737541	5.317803383	5.280365467	5.240253448	5.172633171	5.072428703	4.962061882	4.855110168	4.769142151	4.71976614	4.733018875	4.811459064	4.913545609	5.020081043	5.118351936	5.199835777	5.260653496	5.30182457	5.339449883	5.379134655	5.418875217	5.455482006
5.34997797	5.310119152	5.269709587	5.22988081	5.1925354	5.151593208	5.083664894	4.984196186	4.873878002	4.767121792	4.681289673	4.632609367	4.64626503	4.723340034	4.825244427	4.931768894	5.029938221	5.111438751	5.172159195	5.213900566	5.251628876	5.291259766	5.330974579	5.366952896
5.26192379	5.221935272	5.181501865	5.141536236	5.104102612	5.063984871	4.996364594	4.896165371	4.785797119	4.678843975	4.592889309	4.543550014	4.556823254	4.635266304	4.737358093	4.843893051	4.942163944	5.023646355	5.084471226	5.125658035	5.16333437	5.20310545	5.242751598	5.278929234
5.17366457	5.133743763	5.093434334	5.053602219	5.016266346	4.975327015	4.907412529	4.807940483	4.697619438	4.590864658	4.505057812	4.456404209	4.470073223	4.547133923	4.649032593	4.755548	4.85371685	4.935219288	4.995947361	5.037714005	5.07545805	5.114736557	5.152663708	5.186564445
5.08553648	5.045501232	5.005205154	4.96528244	4.927882671	4.887757301	4.82015276	4.719952106	4.609594345	4.502636909	4.416694164	4.367367268	4.380634308	4.459028721	4.561093807	4.667631626	4.765893459	4.847385406	4.908212185	4.9494524	4.987198353	5.026732445	5.062558174	5.092769146
4.997297764	4.957301617	4.917129993	4.877353668	4.840064526	4.799129009	4.73123312	4.631759644	4.521423817	4.414683819	4.328847885	4.280193329	4.2938447	4.370880127	4.472782135	4.579287052	4.677465439	4.758975029	4.819674492	4.861465931	4.899239063	4.938526154	4.974612236	5.005916119
4.90917778	4.869086742	4.828949928	4.789052963	4.751675606	4.711549759	4.643948555	4.543752193	4.433381557	4.326429844	4.24047327	4.191143513	4.204412937	4.28278923	4.384866238	4.491391182	4.589672089	4.671154022	4.731964111	4.773161888	4.81081295	4.850322247	4.888794899	4.924183846
4.821000576	4.780867577	4.74086237	4.701125145	4.663789749	4.622883797	4.55494833	4.455483913	4.345165253	4.238425732	4.152617455	4.103957176	4.117608547	4.19464016	4.296516418	4.403001308	4.501187325	4.582669258	4.643392563	4.685095787	4.722844124	4.762449741	4.802064419	4.838763237
4.732803822	4.692597866	4.65267086	4.6127882	4.575395107	4.535253525	4.467648506	4.367443085	4.2571311	4.150192261	4.064252377	4.014930248	4.028214455	4.106568813	4.20858717	4.315075397	4.41336441	4.494821548	4.555642605	4.596805096	4.634446621	4.674091816	4.71377182	4.751261234
];
z_bedrock = z_surface - 1;

% Create vertical nodes
z_vertical = linspace(0, 1, nz); % Normalized vertical positions
z_vertical = reshape(z_vertical, [1, 1, nz]);
z_vertical = z_bedrock + (z_surface - z_bedrock) .* z_vertical;

% Create 3D figure
% Set figure properties for A4 size
set(gcf, 'PaperUnits', 'centimeters');  % Set units to centimeters
set(gcf, 'PaperSize', [21, 29.7]);      % A4 paper size: 21 cm x 29.7 cm
set(gcf, 'PaperPosition', [0, 0, 21, 29.7]);  % Fill the entire A4 size

% Optional: Adjust properties if you want to ensure proper margins
% For example, with a margin of 1 cm:
% set(gcf, 'PaperPosition', [1, 1, 19, 27.7]);


for ii = 1:1
% ax = subplot(1,3,ii);
ax = axes('FontSize', 14, 'LineWidth', 1.5);
hold on;

% Plot terrain surface with colormap
surf_handle = surf(ax, x_grid, y_grid, z_surface, 'FaceColor', 'interp', 'EdgeColor', 'none');
colormap(Terrain_RAS);

% Define specific contour levels
levels = [4:0.25:9.5];  % Contours at Z = 0.5, 1, 2, 3

% Add contour labels at the top of the surface
color_label = [55, 72, 96]/255;
color_contour = [184, 184, 184]/255;
[c, contour_handle] = contour3(x_grid, y_grid, z_surface, levels, 'LineColor', color_contour, 'LineWidth', 0.8);
% clabel(c,contour_handle, 'FontSize', 16, 'Color', 'k','FontName','Garamond');

% Plot bedrock elevation
mesh(ax, x_grid, y_grid, z_bedrock, 'EdgeColor', 'k', 'LineStyle', '--', 'LineWidth', 0.8);

% Represent the soil matrix between the top surface and bedrock
for i = 1:ny-1
    for j = 1:nx-1
        x_patch = [x_grid(i, j), x_grid(i+1, j), x_grid(i+1, j+1), x_grid(i, j+1)];
        y_patch = [y_grid(i, j), y_grid(i+1, j), y_grid(i+1, j+1), y_grid(i, j+1)];
        z_patch_top = [z_surface(i, j), z_surface(i+1, j), z_surface(i+1, j+1), z_surface(i, j+1)];
        z_patch_bottom = [z_bedrock(i, j), z_bedrock(i+1, j), z_bedrock(i+1, j+1), z_bedrock(i, j+1)];

        % Create side patches to fill soil matrix
        color_soil = [39, 35, 36]/255;
        fill3([x_patch(1) x_patch(2) x_patch(2) x_patch(1)], ...
              [y_patch(1) y_patch(2) y_patch(2) y_patch(1)], ...
              [z_patch_bottom(1) z_patch_bottom(2) z_patch_top(2) z_patch_top(1)], ...
              color_soil, 'FaceAlpha', 1, 'EdgeColor', 'none');
        fill3([x_patch(2) x_patch(3) x_patch(3) x_patch(2)], ...
              [y_patch(2) y_patch(3) y_patch(3) y_patch(2)], ...
              [z_patch_bottom(2) z_patch_bottom(3) z_patch_top(3) z_patch_top(2)], ...
              color_soil, 'FaceAlpha', 1, 'EdgeColor', 'none');
        fill3([x_patch(3) x_patch(4) x_patch(4) x_patch(3)], ...
              [y_patch(3) y_patch(4) y_patch(4) y_patch(3)], ...
              [z_patch_bottom(3) z_patch_bottom(4) z_patch_top(4) z_patch_top(3)], ...
              color_soil, 'FaceAlpha', 1, 'EdgeColor', 'none');
        fill3([x_patch(4) x_patch(1) x_patch(1) x_patch(4)], ...
              [y_patch(4) y_patch(1) y_patch(1) y_patch(4)], ...
              [z_patch_bottom(4) z_patch_bottom(1) z_patch_top(1) z_patch_top(4)], ...
              color_soil, 'FaceAlpha', 1, 'EdgeColor', 'none');
    end
end

% % Plot vertical nodes
% for i = 1:ny
%     for j = 1:nx
%         plot3(repmat(x_grid(i, j), [nz, 1]), repmat(y_grid(i, j), [nz, 1]), squeeze(z_vertical(i, j, :)), ...
%               'k-', 'LineWidth', 0.5, 'Color', [0 0 0 0.6]);
%     end
% end

% Add color bar
cbar = colorbar;
cbar.Label.String = '\bf Elevation [m]';
cbar.Label.Interpreter = 'latex';
cbar.FontSize = 14;
cbar.LineWidth = 1.5;
cbar.TickDirection = 'out';

% Set axis labels
xlabel('\bf Cross-slope distance $x$ [m]', 'Interpreter', 'latex', 'FontSize', 14);
ylabel('\bf Upslope distance $y$ [m]', 'Interpreter', 'latex', 'FontSize', 14);
zlabel('\bf $z$ [m]', 'Interpreter', 'latex', 'FontSize', 14);

% Configure axis ticks
ax.XAxis.TickDirection = 'out';
ax.YAxis.TickDirection = 'out';
ax.ZAxis.TickDirection = 'out';
ax.XAxis.TickLength = [0.02 0.02];
ax.YAxis.TickLength = [0.02 0.02];
ax.ZAxis.TickLength = [0.02 0.02];

view(135,20)
axis equal
axis tight
grid on;
box on;

hold off;
end

%%
exportgraphics(gcf,'LEO_DEM.svg', 'ContentType', 'vector');
exportgraphics(gcf, 'LEO_DEM.tiff', 'Resolution', 300);